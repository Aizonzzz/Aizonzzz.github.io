---
layout: post
title: Going to B
category: project
description: P90 RUSH B!!!
---
B楼是西电的一个神奇的地方。这个地方的神奇之处在于它错综复杂的楼层结构和迷宫一般的寻路体验。总体来说，B楼是栋东西方向的长楼，从西到东，每一层的教室按具体的教室号排列。这么一说，怎么找具体教室可以说很清楚了，问题在于，为了满足前后排的上课体验，教室内部的地面被设计成了阶梯状的，于是教室就是斜的，于是平行于教室的楼层地面也都是斜的。这么说吧，从最西边进入B楼，会直接到达三楼，而从中间的某些地方则是二楼或者一楼。需要注意的是，B楼还分南楼北楼，大部分的教室在南楼，北楼只有4楼和5楼。南北楼在某些地方是联通的，但由于北楼的教室不是东西向而是南北向的，故北楼的楼层地面是水平的，于是在联通处南楼的楼层要比北楼的楼层数一般大一，也就是想从南楼到北4楼，需要先爬到南楼的5楼，再走到联通处。    
更麻烦的是B楼虽然入口众多，实际常开的入口只有寥寥几个。这就导致去特定教室需要走特别的入口，否则会绕很大的弯。  
于是我们就做了一个B楼导航的App，只需要输入出发地（所在宿舍楼号）和目的地教室编号，就会返回详尽的路径，实在是路痴福利啊。  
主界面如图示，输入出发地和目的地，点击查询即可。![](http://ww1.sinaimg.cn/large/006kidMZly1fg051mogmij305f09mmx3.jpg)
输入时会有下拉菜单可以选取。这里用的是autoCompleteTextView实现的。
![](http://ww1.sinaimg.cn/large/006kidMZly1fg04z5xnd1j305f09mmxa.jpg)
接下来第一步会将你导航到具体的入口处。在此调用了高德地图的api，我们在地图上预设了出发宿舍楼号和B楼每一个入口的坐标，并根据输入情况计算出入口并导出路径。
![](http://ww1.sinaimg.cn/large/006kidMZly1fg055hpf9ej305f09m3z2.jpg)
本来想可以根据当前位置来询问使用者是否已到入口附近，以开始楼内导航，但实践过程中发现有GPS不准确的问题，让使用者自己决定体验更好。（~~实际上是懒得改代码~~   
点击“已到达B楼按钮”，进入楼内导航部分。  
楼内导航一般两步，每一步都是图片+文字。图片支持手势放大和缩小，但是andriod原生在这方面支持不太好，需要自己去写各种监听器实现。于是偷懒这里用了photoview，是github上的一个开源项目，可以很方便地实现这个功能。第一步告诉你入口长什么样子让你快进去，第二步告诉你应该从哪个楼梯上去，上几层楼以及之后往什么方向走到达目的地。这里偷了个懒，也许三步会更好吧，可以将往什么方向走这个移到第三步，并配一张照片。当然部分教室不需要爬楼梯，这部分的只有一步233。（~~实际上也还是懒，照片太多了真的麻烦~~  
此处展示第二步。这里的界面就有点丑了QAQ。
![](http://ww1.sinaimg.cn/large/006kidMZly1fg05iwc53fj305f09m74p.jpg)
至此，导航结束。  
也是第一次写Android吧，很多东西都不太懂，像第一个界面看起来蛮简洁优雅的，实际上是我照着网上别人写的登录界面做的，界面设计部分的各种layout和margin padding之类的没有css的基础实在是有点头大。  
本来想要用图来算具体的路径，后来想了想B楼是个立体图，建图过程麻烦得上天，需要建多个图才能解决问题。于是作罢，最后用了最粗暴的switch来作主算法，将教室和离教室最近的楼梯绑定，楼梯则和最近的入口绑定，写起来倒是不麻烦，代码量却蔚为壮观= =  
比较麻烦的是各个activity之间的传值，mainActivity接受使用者输入的信息并完成路径计算，传递给mapActivity，mapActivity虽然不需要计算路径，却也需要把起点终点的信息传递给最后负责楼内导航的activity。这方面也是百度了很多才解决问题。  
嘛，收获很多，作文以记之。